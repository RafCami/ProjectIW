<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <title>Document</title>
</head>
<body>
    <div class="container row">
        <div class="col-md"></div>
        <div class="col-md-6 mt-3">
            <h1>Registreer</h1>
            <p>Meld je aan bij Anoroc Services, wij beschermen jouw  software tegen malware!</p>
            <form action="#" id="RegisterForm">
                <div class="row mb-3">
                    <div class="col">
                        <label class="form-label" for="firstname">Voornaam</label>
                        <input type="text" name="firstname" id="firstname" placeholder="Uw voornaam" class="form-control">
                    </div>
                    <div class="col">
                        <label class="form-label" for="lastname">Naam</label>
                        <input type="text" name="lastname" id="lastname" placeholder="Uw naam" class="form-control">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col">
                        <label class="form-label" for="username">Gebruikersnaam</label>
                        <input type="text" name="username" id="username" placeholder="Gebruikersnaam" class="form-control">
                    </div>
                    <div class="col">
                        <label class="form-label" for="email">E-mailadres</label>
                        <input type="email" name="email" id="email" placeholder="mail@example.com" class="form-control">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col">
                        <label class="form-label" for="password">Wachtwoord</label>
                        <input type="password" name="password" id="password" placeholder="" class="form-control" aria-describedby="passwordHelp">
                        <div id="passwordHelp" class="form-text">Je wachtwoord moet minstens 8 tekens lang zijn.</div>
                    </div>
                    <div class="col">
                        <label class="form-label" for="passwordvalidate">Herhaal wachtwoord</label>
                        <input type="password" name="passwordvalidate" id="passwordvalidate" placeholder="" class="form-control">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col">
                        <label class="form-label" for="address">Adres</label>
                        <input type="text" name="address" id="address" placeholder="Uw adres en huisnummer" class="form-control">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col">
                        <label class="form-label" for="country">Land</label>
                        <input type="text" name="country" id="country" placeholder="Kies een land" class="form-control">
                    </div>
                    <div class="col">
                        <label class="form-label" for="province">Provincie</label>
                        <input type="text" name="province" id="province" placeholder="Kies een provincie" class="form-control">
                    </div>
                    <div class="col">
                        <label class="form-label" for="postalcode">Postcode</label>
                        <input type="text" name="postalcode" id="postalcode" placeholder="" class="form-control">
                    </div>
                </div>
                <hr>
                <div class="row mb-3">
                    <div class="col">
                        <h4>Hou me op de hoogte</h4>
                        <div class="form-check">
                            <input type="checkbox" name="newsletter" id="newsletter" class="form-check-input">
                            <label class="form-check-label" for="newsletter">Inschrijven voor onze nieuwsbrief</label>
                        </div>
                        <div class="form-check">
                            <input type="checkbox" name="agree" id="agree" class="form-check-input">
                            <label class="form-check-label" for="agree">Ik ga akkoord met de algemene voorwaarden</label>
                        </div>
                    </div>
                    <div class="col">
                        <h4>Betaling</h4>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment" id="bankingapp" value="Banking app">
                            <label class="form-check-label" for="bankingapp">Banking App</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment" id="wire" value="Overschijving">
                            <label class="form-check-label" for="wire">Overschijving</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment" id="visa" value="Visa">
                            <label class="form-check-label" for="visa">VISA card</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="payment" id="paypal" value="PayPal">
                            <label class="form-check-label" for="paypal">PayPal</label>
                        </div>
                    </div>
                </div>
                <hr>
                <div class="d-grid">
                    <button type="button" class="btn btn-primary" onclick="Buttonclick()">Wave your magic wand</button>
                </div>
            </form>
        </div>
        <div class="col-md mt-3">
            <div id="response" class="invisible"></div>
            <div id="responsePayment" class="alert alert-primary invisible">
                <h4>Betalingswijze</h4>
                <p></p>
            </div>
        </div>
    </div>

    <script>
        function Buttonclick() {
            //Get form data and create FormData (dictionary) object for easy data access;
            //https://developer.mozilla.org/en-US/docs/Web/API/FormData
            let registerForm = new FormData(document.getElementById('RegisterForm'));
            let errors = [];

            //iterate over form entries
            for (var pair of registerForm) {
                let emptyMessage = '';
                //check which field gets checked
                switch (pair[0]) {
                    case 'firstname':
                        emptyMessage = 'Het veld voornaam is vereist';
                        break;
                    case 'lastname':
                        emptyMessage = 'Het veld naam is vereist';
                        break;
                    case 'username':
                        emptyMessage = 'Het veld gebruikersnaam is vereist';
                        break;
                    case 'address':
                        emptyMessage = 'Het veld adres is vereist';
                        break;
                    case 'country':
                        emptyMessage = 'Het veld land is vereist';
                        break;
                    case 'province':
                        emptyMessage = 'Het veld provincie is vereist';
                        break;
                    case 'postalcode':
                        if (pair[1]) { 
                            let pcError = checkPC(pair[1]); 
                            if (pcError) errors.push(pcError);
                        }
                        else emptyMessage = 'Het veld postcode is vereist';
                        break;
                    case 'email':
                        if (pair[1].length > 0) {
                            if (!validateEmail(pair[1])) errors.push('E-mailadres is niet correct');
                        } else emptyMessage = 'Het veld e-mail is vereist';
                        break;
                    case 'password':
                        if (pair[1].length == 0) emptyMessage = 'Het veld wachtwoord is vereist'; //check for empty password
                        else if (pair[1].length <= 7) errors.push('Het wachtwoord moet minstens 8 karakters lang zijn'); //check for too short password
                        break;
                    case 'passwordvalidate':
                        if (pair[1].length == 0) emptyMessage = 'Het veld herhaal wachtwoord is vereist'; //check for empty password validation
                        else if (registerForm.get('password').length >= 8 && pair[1] != registerForm.get('password')) errors.push('Beide wachtwoord velden moeten gelijk zijn'); //password is long enough AND fields not equal
                        break;
                }
                
                let checkResult = '';
                //check if empty field
                if (emptyMessage != '') checkResult = checkEmptyField(pair[1], emptyMessage); 
                if (checkResult != '') errors.push(checkResult);
            }

            //handle checkboxes
            //if checked set value to 1 else 0
            registerForm.set('newsletter', registerForm.has('newsletter') ? 1 : 0);
            registerForm.set('agree', registerForm.has('agree') ? 1 : 0);
            if (registerForm.get('agree') == '0') errors.push('Je moet de algemene voorwaarden accepteren'); //check if agreements are accepted

            //handle radio buttons
            //check if payment method is chosen
            if (registerForm.get('payment'))  validatePayment(registerForm.get('payment')); //set payment div
            else errors.push('Je moet een betalingswijze kiezen');

            //construct alert div
            let content = '';
            let classes = ['alert'];
            if (errors.length > 0) {
                //alert content on errors
                content += '<h4>Yikes errors...</h4><p>';
                errors.forEach(e => content += `${e}<br>`);                
                content += '</p>';
                //alert classes on errors
                classes.push('alert-danger');
                document.getElementById('responsePayment').classList.add('invisible'); //hide payment div
            } else {
                content += '<h4>Goed gedaan!</h4><p>';
                content += 'Aww yeah, je werd geregistreerd.</p>';
                classes.push('alert-success');
                document.getElementById('responsePayment').classList.remove('invisible'); //show payment div
            }
            //set alert div classes and content
            let response = document.getElementById('response');
            response.className = ''; //Clear classes
            classes.forEach(c => response.classList.add(c)); //Add every class
            response.innerHTML = content; //Set content
        }

        function checkEmptyField(field, message) {
            if (field == '') return message;
            else return '';
        }

        function validateEmail(email) {
            const reg = /^[a-zA-Z0-9_][a-zA-Z0-9_\-\.]*@[a-zA-Z0-9][a-zA-Z0-9\-\.]*\.[a-zA-Z0-9\-\.]+/; //email regex
            //const reg = /.+@.+\..+/; //email must contain any number of characters, an '@', any number of characters, a '.', any number of characters 
            return email.match(reg); //return if email matches
        }

        function validatePayment(payment) {
            //construct alert text
            let alertText;
            if (payment) {
                alertText = `Je betalingswijze is ${payment}`;
            }
            else {
                alertText = 'Je hebt geen betalingswijze gekozen';
            }
            //set payment div content
            document.getElementById('responsePayment').getElementsByTagName('p')[0].innerHTML = alertText;
        }

        function checkPC(postalcode) {
            //check if postalcode is valid
            const reg = /^[1-9][0-9]{3}$/; //postal code regex
            if (!postalcode.match(reg)) return 'De waarde van postcode moet tussen 1000 en 9999 liggen';
        }
        
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
</body>
</html>